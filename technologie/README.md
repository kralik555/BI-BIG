# MongoDB

## Popis technologie

### Obecné chování
MongoDB je open source databáze využívající JSON-like dokumenty k ukládání dat. Narozdíl od relačních databází s pevně danými tabulkami a sloupci může tedy ukládat data s různými strukturami a dobře se přizpůsobuje změnám ve schématu databáze. Narozdíl od relačních databází však nepodporuje komplexní joiny. Oproti Redisu je MongoDB více zaměřené na dlouhodobé uchovávání dat a komplexní dotazy, zatímco Redis uchovává všechna data in-memory a je tedy dobrý pro rychlou práci s daty. Neo4j je grafová databáze, čímž se velmi liší od MongoDB. Neoj4 je oproti MongoDB lepší na ukládání vysoce propojených dat. Apache Cassandra rozdílná v tom, že nemá žádný "master" node a je díky tomu vysoce škálovatelná.

### Základní principy
MongoDB je NoSQL databáze s dokumentově orientovanou strukturou dat. Pro distribuci dat je v MongoDB využíván sharding, což umožňuje databázi horizontální škálování pomocí rozdělení dat na několik serverů. Každý shard se chová jako samostatná databáe a celkvoá struktura je udělaná tak, aby optimalizovala dotazování nad jednotlivými shardy. K replikaci využívá MongoDB set replik, což je skupina instancí, které udržují ten stejný dataset. Tento přístup zajišťuje nadbytečnost dat a tím pádem zajišťuje bezpečnost a dostupnost dat v případě chyby u jednoho ze serverů. Co se rozdílnosti architektury týče, je MongoDB vytvořena pro ukládání komplexních dat, v čemž se liší s Redisem, který má klíč-hodnota strukturu ukládání dat. Apache Cassandra je svou strukturou podobnější klasickým relačním databázím tím, že využívá tabulky, ale jména sloupců v každém řádku můžou být jiná. A narozdíl od Neo4j, což je grafová databáze a vyniká tudíž práci s vysoce propojenými daty, je MongoDB lepší v práci s daty, kde jsou vztahy méně komplexní, ale vyžadují větší flexibilitu ve schématu.

### CAP teorém
MongoDB garantuje konzistenci a toleranci vůči dělení dat. Pro mé řešení je toto dostatečné, jelikož pro content management system je důležité, aby uživatelé viděli nejaktuálnější a přesné verze verze kontentu. Tolerance vůči dělení dat je důležitá pro přístup k datům i v případě, že některé části sítě jsou nedostupné. Dostupnost ve všech případech sice není možná, ale dá se jí přiblížit pomocí replikace. Dostupnost také není často nejpodstatnější, například zobrazení současného a správného kontentu je důležitější než schopnost vždy zobrazit i starý a nekonzistentní kontent.

### Architektura
Architektura mého řešení obsahuje jeden cluster. Více clusterů není u mého řešení potřeba, jelikož mám poměrně málo dat. Tento cluster obsahuje tři config servery, které jsou udělané jako replika sety, což zvyšuje jejich spolehlivost a dostupnost, jelikož i kdyby vypadl jeden, ostatní dva jsou stále dstupné. Tyto uzly ukládají metadata o stavu clusteru, rozědlení shardů a umístění dat. Dále cluster obsahuje 2 mongos routery, přes které se uživatelé mohou připojit k databázi a které umožňují dotazování nad daty a směrují dotazy k odpovídajícím shardům. Nakonec je součástí clusteru 6 uzlů rozdělených do dvou shardů. Každá shard je replika set složený ze tří uzlů, které ukládají skutečná data. Tato struktura zajišťuje jak replikaci tak sharding. Několik replika setů zajišťuje vysokou dostupnost a odolnost vůči selháním. Díky tomu, že jsou data uložená vícekrát, budou data dostupná i v případě výpadku jednoho uzlu. Díky výše zmíněnému shardingu se zátěž může rozložit mezi více serverů. Díky tomuto může být databáze škálována horizontálně, což umožňuje efektivní práci s velkými objemy dat. Databáze dokáže pracovat s jakýmikoli datovými formáty a strukturami už z podstaty dokumentových databází a jejich práce s daty jako JSON objekty. MongoDB, jakožto dokumentově orientovaná databáze byla zvolena proto, že v content management systému se vyskytují a různé typy obsahu, na což je tento typ databází ideální. Dalším důvodem výběru MongoDB je její škálovatelnost, jelikož v takovémto typu databáze může nový obsah přibývat závratnou rychlostí a mohou se objevovat i nové typy dat, což není díky flexibilitě MongoDB problém. Tato databáze bude pracovat s několika desítkami generovaných datových objektů, ale byla by schopná pracovat i s mnohem většími objemy, zvlášť kdyby byla trochu upravena a bylo přidáno více shardů. Data, se kterými bude databáze pracovat jsou generována Python skriptem, který je uložen ve stejné složce jako zbytek zdrojových souborů.

### Perzistence
Data načtená z disku jsou uložena v RAM a zapisovaná data jsou nejprve také uložena v RAM. To umožňuje Mnogu rychlý přístup k datům, která jsou využívána častěji. Při každém čtení se nejprve databáze podívá do primární paměti a do sekundární až pokud nenajde hledaou položku. Veškerá data jsou nakonec uložena do sekundární paměti (na disk) v intervalech nebo při přetečení cache. To zajišťuje perzistenci dat i přes restarty nebo selhání. Celkově takovýto přístup umožňuje rychlý přístup k datům a zároveň i jejich zabezpečení před ztrátou.  

### Zabezpečení
V MongoDB je možné zabezpečení dat pomocí šifrování. Na data putující mezi jednotlivými uzly je také možné aplikovat přenosovou šifru, díky čemuž nelze data zachycená např. pomocí WireShark přečíst. Pro provozování takového zabezpečení je však ve všech uzlech databázové sítě vytvořit certifikát podepsaný certifikační autoritou. Další možností je využití přihlášení pomocí uživatelského jména a hesla. Ve svém řešení jsem se pokusil použít autentizaci pomocí přihlašovacího jména a hesla, ale nepodařilo se mi bohužel zprovoznit, tak jsem se vrátil k původnímu setupu.

### Výhody a nevýhody
Velká výhoda MongoDB a dokumentových databází obecně je jejich rychlost. Další výhodou je práce s daty ve formátu JSON, díky čemuž není potřeba data upravovat na straně aplikace. Další výhodou je velká flexibilita dat, což znamená, že v dokumentech může být prakticky cokoliv. Asi největší nevýhodou dokumentově orientovaných databází je nezaručená integrita dat. Ve větším měřítku může docházet k velkému nadbytku a duplicitě dat.

### Případy užití
V mém řešení jsem využil databáze MongoDB pro její flexibilitu, jelikož systém na management kontentu může obsahovat různé typy datových objektů (články, videa, obrázky atd.). Další z důvodů pro volbu MongoDB je její škálovatelnost, která je potřeba kvůli možnosti rapidního nárůstu množství dat. Další důležitou vlastností MongoDB pro takovýto typ databáze je konzistence, která je klíčová pro zobrazování správného obsahu uživatelům. Redis jsem nezvolil, jelikož není tak vhodný pro dlouhodobé ukládání komplexního obsahu. Apache Cassandra jsem nevyužil, jelikož není dostatečně flexibilní na ukládání různých druhů dat. Neo4j jsem nezvolil, jelikož je vhodnější na práci s vysoce propojenými daty, jako by byly sociální sítě. Využití MongoDB je vhodné v případě, že je potřebná flexibilita ve formátu vlkádaných dat a struktuře databáze a škálovatelnost, například u e-shopů a u systémů na správu uživatelských dat. Použití MongoDB je naopak nevhodné u databází, ve kterých je nutné vysoké a koplexní propojení dat, jako jsou bankovní systémy či sociální sítě.

## Popis vlastního datasetu
Můj dataset je generovaný pomocí Python skriptu a knohivny Faker, je tudíž pokaždé trochu jiný. Dataset obsahuje několik desítek různých záznamů, přičemž záznamy jsou jedním ze čtyř různých druhů: blog, článek, obrázek a video. Všechn tyto druhy kontentu mají několik stejných atributů: název, typ kontentu, jméno autora a datum vydání. Dále mají blog a článek ještě atribut text, který je jejich obsahme. Obrázky a videa mají ještě atribut URL, který odkazuje na uložení obsahu. Samotný obsah videí a obrázků již není součástí datasetu.

## Závěr

### Zdroje
https://chat.openai.com/
https://courses.fit.cvut.cz/BI-BIG/
https://en.wikipedia.org/wiki/MongoDB
https://www.giorgosdimtsas.net/blog/docker-compose-for-a-local-mongodb-cluster/
https://www.mongodb.com/
